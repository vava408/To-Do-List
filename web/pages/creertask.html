<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cr√©er une T√¢che</title>

<script src="../assets/js/darkMode.js"></script>


<!-- Style de la page -->
<link rel="stylesheet" href="../assets/css/create-task.css" />

<!-- Script perso pour la taille du texte -->
<script type="module" src="../assets/js/tailleTexte.js"></script>
</head>

<body>
	<div class="container">

		<!-- En‚Äêt√™te avec navigation -->
		<header class="header">
			<h1>Cr√©er une T√¢che</h1>
			<nav class="nav">
				<div class="theme-switch-wrapper">
				    <label class="theme-switch" for="theme-toggle">
				        <input type="checkbox" id="theme-toggle" data-theme-toggler />
				        <div class="slider">
				            <span class="slider-icon light">‚òÄÔ∏è</span>
				            <span class="slider-icon dark">üåô</span>
						 </div>
				    </label>
				</div>
				<a href="home.html">Accueil</a>
				<a href="tasks.html">Mes T√¢ches</a>
				<a href="../auth/logout.php" id="logoutOrLogin">D√©connexion</a>
			</nav>
		</header>

		<!-- Zone o√π le message de succ√®s/erreur sera affich√© -->
		<div id="message" style="margin-bottom: 15px; font-weight:bold;"></div>

		<!-- Formulaire de cr√©ation de t√¢che -->
		<!-- Pas de action/method car c'est g√©r√© en JS -->
		<form id="taskForm" class="task-form">
		
			<div class="form-group">
				<label for="title">Nom de la t√¢che</label>
				<input type="text" id="title" name="title" required>
			</div>

			<div class="form-group">
				<label for="description">Description</label>
				<textarea id="description" name="description" rows="3" required></textarea>
			</div>

			<div class="form-group">
				<label for="due_date">Date limite</label>
				<input type="date" id="due_date" name="due_date" required>
			</div>

			<div class="form-group">
				<label for="status">Statut</label>
				<select id="status" name="status" required>
					<option value="not_started">Non commenc√©e</option>
					<option value="in_progress">En cours</option>
					<option value="completed">Compl√©t√©e</option>
				</select>
			</div>

			<div class="form-group">
				<label for="priority">Priorit√©</label>
				<select id="priority" name="priority" required>
					<option value="Importante">Importante</option>
					<option value="Moyenne">Moyenne</option>
					<option value="Faible">Faible</option>
				</select>
			</div>

			<button type="submit" class="btn">Cr√©er la t√¢che</button>
		</form>
	</div>

<!-- Script AJAX -->
<script>
// On ajoute un "listener" sur le formulaire quand il est soumis
document.querySelector('#taskForm').addEventListener('submit', async (e) => {

	// Emp√™che le rechargement normal de la page
	e.preventDefault();

	// R√©cup√®re les donn√©es du formulaire
	const formData = new FormData(e.target);

	// Envoie des donn√©es au fichier PHP via fetch (AJAX)
	const response = await fetch('../tasks/add.php', {
		method: 'POST',
		body: formData
	});

	// On r√©cup√®re la r√©ponse JSON envoy√©e par add.php
	const result = await response.json();

	// S√©lecteur o√π on affiche le message
	const msg = document.querySelector('#message');

	// Si le PHP renvoie une erreur
	if (result.error) {
		msg.textContent = result.error;
		msg.style.color = 'red';

	// Si le PHP renvoie un succ√®s
	} else if (result.success) {
		msg.textContent = result.success;
		msg.style.color = 'green';

		// Redirection vers la liste des t√¢ches apr√®s 1 seconde
		setTimeout(() => {
			window.location.href = "tasks.html";
		}, 1000);
	}
});
</script>

</body>
</html>
