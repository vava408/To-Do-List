<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Accueil - Gestionnaire de T√¢ches</title>
  <link rel="stylesheet" href="../assets/css/home.css" />
</head>
<body>
	<div class="container">
		<header class="header">
			<h1 id="welcome">Bienvenue üëã</h1>
	 		<nav class="nav">
				<a href="../pages/tasks.html">Mes T√¢ches</a>
				<a href="#">Profil</a>
				<a href="../auth/logout.php" id="logoutOrLogin">D√©connexion</a>
			</nav>
		</header>

		<section class="summary">
			<h2>Derni√®res t√¢ches</h2>
			<div class="stats">
				<div class="stat-box">
					<p>Total des t√¢ches</p>
					<strong id="totalTasks">[nombre de taches]</strong>
				</div>
				<div class="stat-box">
					<p>Compl√©t√©es</p>
					<strong id="completedTasks">[nombre de taches completes]</strong>
				</div>
				<div class="stat-box">
					<p>En cours</p>
					<strong id="ongoingTasks">[nombre de taches en cours]</strong>
				</div>
				<div class="stat-box">
					<p>Non commenc√©es</p>
					<strong id="notStartedTasks">[nombre de taches non commencees]</strong>
				</div>
			</div>
		</section>

		<section class="recent-tasks">
			<h2>Derni√®res t√¢ches</h2>
			<ul class="task-list">
				<li><span class="emoji">‚úÖ</span> <span id="task-end" >[texte derniere tache fini]</span></li>
				<li><span class="emoji">üïì</span><span id="task-in-progresse">[texte derniere tache en cours]</span></li>
				<li><span class="emoji">‚è≥</span><span id="task-not-start">[texte derniere tache non commencee]</span</li>
			</ul>
			<a class="btn" href="#">Voir toutes les t√¢ches</a>
		</section>
	</div>



<script>
  // Envoie une requ√™te HTTP pour r√©cup√©rer les informations de l'utilisateur depuis le fichier user.php
	fetch('..//tasks/dahboardData.php?pages=home', {
		credentials: 'include'
	})
  
	// Lorsque la r√©ponse est re√ßue, on la convertit en objet JavaScript (format JSON)
	.then(response => response.json())
	
	// Quand les donn√©es sont pr√™tes, on les utilise
	.then(data => {
		// On extrait le nom d'utilisateur de l'objet JSON
		const user = data.user;
		const totalTasks = data.stat.nbTasks;
		const totalTasksComp = data.stat.nbTasksCompleted;
		const totalTasksEnCours = data.stat.nbTasksEnCours;
		const totalTaskNotStart      = data.stat.nbTaskNotStart;
		const lastTaskFinish = data.lastTask.completed;
		const lastTaskInProgresse = data.lastTask.inProgresse;
		const lastTaskNotStart = data.lastTask.notStated;

		// On met √† jour le texte de l'√©l√©ment HTML avec l'id "welcome"
		// pour dire "Bienvenue, [nom de l'utilisateur] üëã"
		document.getElementById('welcome').innerText = `Bienvenue, ${user} üëã`;
		document.getElementById('totalTasks').innerText = totalTasks;
		document.getElementById('completedTasks').innerText = totalTasksComp;
		document.getElementById('ongoingTasks').innerText = totalTasksEnCours;
		document.getElementById('notStartedTasks').innerText = totalTaskNotStart;
		document.getElementById('task-end').innerText = lastTaskFinish;
		document.getElementById('task-in-progresse').innerText = lastTaskInProgresse;
		document.getElementById('task-not-start').innerText = lastTaskNotStart;


		if(user === 'guest')
		{
			document.getElementById('logoutOrLogin').innerText = 'Se connecter';
			document.getElementById('logoutOrLogin').setAttribute('href', '../pages/login.html');
		}
		console.log(`Bienvenue, ${user} üëã`);
		console.log(`Total des t√¢ches : ${totalTasks}`);

		console.log(data);
	});
</script>


</body>
</html>
