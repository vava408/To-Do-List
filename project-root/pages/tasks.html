<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Mes Tâches - Gestionnaire</title>
	<link rel="stylesheet" href="../assets/css/task.css" />
</head>

<body>
	<div class="container">
		<header class="header">
			<h1>Mes Tâches</h1>
			<nav class="nav">
				<a href="home.html">Accueil</a>
				<a href="#">Profil</a>
				<a href="../auth/logout.php" id="logoutOrLogin">Déconnexion</a>
			</nav>
		</header>

		<section class="task-overview">
			<div class="stats">
				<div class="stat-box">
					<p>Tâches</p>
					<strong id="totalTasks">0</strong>
				</div>
				<div class="stat-box">
					<p>Complétées</p>
					<strong id="completedTasks">0</strong>
				</div>
			</div>
		</section>

		<section class="task-table">
			<h2>Tâches Récentes</h2>
			<a class="btn" href="../pages/creertask.html">Nouvelle tâche</a>
			<table>
				<thead>
					<tr>
						<th>Nom</th>
						<th>Date limite</th>
						<th>Statut</th>
					</tr>
				</thead>
				<tbody id="t-body">
					<!-- Les tâches seront insérées ici dynamiquement -->
				</tbody>
			</table>
		</section>
	</div>
</body>

</html>

<script>
	fetch('../tasks/dahboardData.php?pages=tasks', { credentials: 'include' })
		.then(response => response.json())
		.then(data => {
			// Mise à jour des statistiques
			document.getElementById('totalTasks').innerText = data.stat.nbTasks;
			document.getElementById('completedTasks').innerText = data.stat.nbTasksCompleted;

			const tbody = document.getElementById("t-body");
			tbody.innerHTML = ""; // vider les lignes statiques

			data.task.forEach((task, index) => {
				const tr = document.createElement("tr");
				tr.id = `task-${index}`;

				// Colonne : titre
				const tdTitle = document.createElement("td");
				tdTitle.textContent = task.title;
				// associe a la ligne
				tr.appendChild(tdTitle);

				// Colonne : date limite
				const tdDate = document.createElement("td");
				tdDate.textContent = task.due_date || "Pas de date";
				// associe a la ligne
				tr.appendChild(tdDate);

				// Colonne : statut avec badge
				const tdStatus = document.createElement("td");
				const span = document.createElement("span");
				span.textContent = task.status;

				if (task.status === "completed") span.className = "badge complete";
				else if (task.status === "in_progress") span.className = "badge progress";
				else span.className = "badge not-started";

				// associe a la ligne
				tdStatus.appendChild(span);
				// associe a la ligne
				tr.appendChild(tdStatus);

				// associe a la ligne
				tbody.appendChild(tr);
			});
		})
		.catch(error => console.error('Erreur :', error));
</script>